---
title: Cipher 4
date: 2023-03-22 21:08:27
tags: cipher
mathjax: true
---

### 分组密码模式

- 分组密码：每次只能处理特定长度的明文的密码算法，这里的一段长度的明文就称之为分组
- 模式：如果一段明文很长，需要迭代很多次才能加密，迭代的方法就是模式
- ECB：将明文切成很多块，每一块独立的加密
- 流密码：能连续处理明文的密码算法。流密码一般以 1 比特，8 比特或 32 比特等单位进行加密和解密
- 密文分组：是指将明文分组加密后的结果。明文分组就是将明文切成很多块中的一块。

<!--more-->

### ECB 模式

示例如下，将明文切成很多块，分别加密后，将密文分组按顺序拼起来就是最终的加密结果

```text
明文分组 1 -> 加密 -> 密文分组 1
明文分组 2 -> 加密 -> 密文分组 2
明文分组 3 -> 加密 -> 密文分组 3
明文分组 4 -> 加密 -> 密文分组 4
明文分组 5 -> 加密 -> 密文分组 5
明文分组 6 -> 加密 -> 密文分组 6
明文分组 7 -> 加密 -> 密文分组 7
```

这个方案下存在很大的危险，在波需要破译密码的情况下，操作密文分组可以视为对明文分组的操作，比如调换顺序，替换，复制，都会对最终的结果造成影响。

### CBC 模式

1. 初始化向量 V
2. 明文分组 1 与向量 V 执行操作，$m_1 \bigoplus V$，得到 $m_1V$，对其加密得到 $Enc(m_1V)$
3. 明文分组 2 与 $Enc(m_1V)$ 执行操作，$m_2 \bigoplus Enc(m_1V)$，得到 $m_2V$，对其加密得到 $Enc(m_2V)$
4. 重复步骤 2、3 直到全部明文加密

解密的过程就是反过来操作，和前面提过的 DES、AES 的解密方式一模一样，这个方案的弱点在于数据不能丢失，如果最终的数据在传输过程中错了 1 比特位或者丢失了 1 比特位，会导致出错的比特位之前的密文分组无法解密。

**填充提示攻击**，因为分组密码的特性，如果待加密的明文不是分组的整数倍的时候，就需要在尾部填充内容构成分组的整数倍。这个时候攻击者可以利用填充的部分更改部分，这样在解密的时候会得到错误信息，根据错误信息和明文，就能得到一部分明文相关的信息。

CTS 模式：该模式是在 CBC 模式下，如果最后一个明文分组不够长度，那么使用上一个密文分组尾部的部分填充到明文中，再进行加密，这里用到了 xor 的性质。

### CFB 模式

1. 初始化向量 V
2. 加密向量 V 得到 $Enc(V)$
3. 明文分组 1 与向量 $Enc(V)$ 执行操作，$m_1 \bigoplus Enc(V)$，得到 $m_1Enc(V)$
4. 将 $m_1Enc(V)$ 加密得到 $Enc(m_1Enc(V))$
5. 明文分组 2 与 $Enc(m_1Enc(V))$ 执行操作，$m_2 \bigoplus Enc(m_1Enc(V))$，得到 $m_2Enc(m_1Enc(V))$
6. 重复步骤 2、3、4、5 直到全部明文分组加密

CFB 模式的解密和之前的 DES、AES 稍有不同，也非常类似。比如要解密最后一个分组 $N$，那么需要加密分组 $N-1$，将加密结果与密文分组 N 做 xor 操作即可得到明文。

**重放攻击**，即使用之前收到的密文分组替换新的密文分组发送给接收者，接收者会得到过去的旧信息，无法解密的部分和能正确解密的第一个密文分组。

### OFB 模式

1. 初始化向量 V
2. 加密向量 V 得到 $Enc(V) $
3. 明文分组 1 与向量 $Enc(V)$ 执行操作，$m_1 \bigoplus Enc(V)$，得到 $m_1Enc(V)$
4. 将 $Enc(V)$ 加密得到 $Enc(Enc(V))$
5. 明文分组 2 与 $Enc(Enc(V))$ 执行操作，$m_2 \bigoplus Enc(Enc(V))$，得到 $m_2Enc(Enc(V))$
6. 将 $Enc(Enc(V))$ 加密得到 $Enc(Enc(Enc(V)))$
7. 重复步骤 3、4、5、6 直到全部明文分组加密

### CTR 模式

1. 初始化比特序列 V
2. 加密 V 得到 $Enc(V)$
3. 明文分组 1 与向量 $Enc(V)$ 执行操作，$m_1 \bigoplus Enc(V)$，得到 $m_1Enc(V)$
4. V + 1
5. 重复步骤 2、3、4 直到所有明文分组全部加密

这个方法的优点是可以并行加密。

### 练习测试

1. 16 字节
2. 用用户名的密文分组覆盖密码的密文分组，这样只需要知道用户名就可以登陆了。而用户名的明文几乎很容易拿到
3. 初始化相同的向量，那么可以通过密文一样，判断出密文对应的明文是一样的。
4. 这个修改相当于将 CBC 模式改成了 ECB 模式，除了第一个密文分组外，后面的密文分组和明文分组，可以直接获得对应关系
5. 这里的加密算法就是 xor，不过用于加密的 xor 密钥是按照一定的规律生成的
6. o x o o
